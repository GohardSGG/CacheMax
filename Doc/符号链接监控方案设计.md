# CacheMax v2.0 符号链接架构性能监控方案

## 问题背景

当前CacheMax从WinFsp虚拟文件系统架构迁移到符号链接架构后，原有的监控系统不再适用：

1. **旧监控机制**：基于WinFsp的缓存命中/丢失统计
2. **新架构特点**：符号链接直接重定向，无传统缓存概念
3. **监控缺失**：缺少性能数据、访问统计、I/O监控

## 新监控方案设计

### 1. 符号链接访问监控

**监控目标**：
- 符号链接目录的访问频率
- 文件读写操作统计
- 访问模式分析（热文件识别）

**实现方式**：
- 使用 FileSystemWatcher 监控缓存目录访问
- 分析文件访问时间戳
- 统计读写操作频率

### 2. 性能度量指标

**核心指标**：
- **响应时间**：文件访问延迟
- **吞吐量**：读写速度 (MB/s)
- **访问频率**：文件访问次数/时间
- **热点文件**：最常访问的文件列表
- **同步状态**：缓存与原始目录同步延迟

**计算方法**：
- 响应时间：通过Hook文件操作或性能计数器
- 吞吐量：监控文件大小和操作时间
- 访问频率：基于FileSystemWatcher事件统计

### 3. 监控数据收集

**数据源**：
1. **文件系统事件**：FileSystemWatcher提供的I/O事件
2. **性能计数器**：Windows性能计数器API
3. **同步服务统计**：FileSyncService内部统计
4. **目录大小变化**：定期扫描缓存目录

**收集频率**：
- 实时事件：文件创建、修改、删除
- 定期统计：每30秒统计一次汇总数据
- 性能测试：用户主动触发或定期自动测试

### 4. 数据展示界面

**实时监控区域**：
- 当前活跃操作数
- 实时读写速度
- 同步队列状态
- 热点文件Top 5

**历史统计图表**：
- 访问量趋势图（24小时）
- 性能趋势图（读写速度）
- 文件大小变化图

**性能对比**：
- 加速前后性能对比
- 与标准硬盘性能对比
- 缓存命中效果模拟

## 技术实现框架

### 1. 监控服务架构

```
PerformanceMonitoringService
├── FileAccessMonitor (文件访问监控)
├── PerformanceCollector (性能数据收集)
├── StatisticsAggregator (统计数据聚合)
└── RealtimeReporter (实时数据报告)
```

### 2. 数据流程

```
文件访问 → FileSystemWatcher → 事件分析 → 性能计算 → 数据聚合 → UI更新
```

### 3. 存储方案

- **内存缓存**：最近1小时的详细数据
- **本地存储**：24小时历史数据（SQLite）
- **配置文件**：长期统计概要

## 预期效果

1. **透明监控**：不影响文件访问性能
2. **实时反馈**：用户能看到加速效果
3. **性能优化**：基于统计数据优化缓存策略
4. **问题诊断**：快速定位性能瓶颈

## 下一步实现

1. 创建 PerformanceMonitoringService 类
2. 集成到 CacheManagerService
3. 更新 MainWindow UI 显示
4. 测试和优化性能影响