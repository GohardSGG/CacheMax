# 沟通与检索准则（首要）

- 搜索工具与范围控制：
  - 默认使用 `rg`（ripgrep）检索代码/文档，始终排除 `**/bin/**`、`**/obj/**`、`**/Cache/**`，必要时再定向到具体子目录。
  - 有明确的文件路径时，直接打开目标文件，不做全局检索。
  - 避免复杂正则导致误匹配，优先使用简单、分步匹配；需要正则时用 PCRE2 语法并先小样本验证。

- 文件读取与输出策略：
  - 只读取必要片段（按行号/上下文小段），默认不整篇输出大文件；同一文件不重复读取大段内容。
  - 输出以“摘要 + 文件路径”优先，尽量少粘贴大块代码；引用路径即可让开发者本地查看。
  - 记录已读文件与定位点，后续仅补充差异，避免重复 IO 与冗余输出。

- 运行与构建约定：
  - 不使用热重载（不使用 `dotnet watch`、`cargo watch`），除非你明确要求。
  - 验证改动优先使用编译构建：`dotnet build ADTask.Shared/Web`；后端采用 `cargo build`/`cargo run`（非 watch）。
  - 参考 `Start_Development.ps1` 获取环境变量与启动参数，但如需本地运行，改为非 watch 的等效命令。

- 认证与路由守卫（前端）一致性：
  - 应用启动立即派发 `Initialize_Auth_Action`（无延时），等待认证状态恢复。
  - 受保护页使用 `AuthGuard` 拦截：未认证时以 SPA 导航跳转到 `/auth?returnUrl=...`（不 `forceLoad`）。
  - 登录成功后优先回跳 `returnUrl`，否则默认跳转 `/timeline`。
  - Token 持久化规则：
    - 勾选“记住我”→ 持久化到 `localStorage`；
    - 未勾选→ 仅内存保存（会话级）。
    - HTTP 客户端统一从 `LocalStorage_Service.Get_Auth_Token()` 读取，避免 key 分裂与来源不一致。

- 沟通与变更原则：
  - 先小范围验证（编译/最小运行）再大改；优先修“根因”而非表象。
  - 变更前后保持说明简洁、可执行；尽量少量、多次、可回溯。
  - 如需读取/修改大量文件，先给出最小计划与影响面，再执行。

