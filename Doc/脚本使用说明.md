# CacheMax 脚本使用说明

## 📋 脚本概览

CacheMax 现在提供了一套完整的批处理脚本，用于不同场景的使用需求：

| 脚本名称 | 用途 | 权限要求 | 说明 |
|----------|------|----------|------|
| `调试CacheMax.bat` | 开发调试 | 普通用户 | 启动Debug版本，允许多实例 |
| `正式CacheMax.bat` | 日常使用 | 普通用户 | 启动Release版本，单实例控制 |
| `安装CacheMax.bat` | 系统安装 | **管理员** | 安装到Program Files |
| `卸载CacheMax.bat` | 系统卸载 | **管理员** | 完全移除安装 |

## 🔧 详细说明

### 1. 调试CacheMax.bat
```
用途: 开发调试和测试
路径: .\CacheMax.GUI\bin\Debug\net8.0-windows\CacheMax.exe
特性:
- ✅ 允许多实例运行
- ✅ 详细调试日志
- ✅ 支持热重载
- ✅ 包含调试符号
```

**使用场景**:
- 开发时需要同时运行多个实例测试
- 调试程序功能和性能
- 测试单实例控制功能

### 2. 正式CacheMax.bat
```
用途: 日常生产使用
路径: .\CacheMax.GUI\bin\Release\net8.0-windows\CacheMax.exe
特性:
- 🔒 强制单实例运行
- ⚡ 优化性能
- 🛡️ 错误处理完善
- 📦 体积更小
```

**使用场景**:
- 日常使用和生产环境
- 性能测试和基准测试
- 演示和用户体验

### 3. 安装CacheMax.bat ⚠️
```
用途: 系统级安装
目标: C:\Program Files\CacheMax\
权限: 需要管理员权限
功能:
- 📁 复制程序文件到系统目录
- 🔗 创建开始菜单快捷方式
- 🖥️ 可选创建桌面快捷方式
- 🌐 可选添加到系统PATH
- 🛑 自动停止运行中的进程
```

**安装内容**:
```
C:\Program Files\CacheMax\
├── CacheMax.exe           # 主程序
├── CacheMax.dll           # 程序库
├── CacheMax.deps.json     # 依赖配置
├── CacheMax.runtimeconfig.json # 运行时配置
├── CacheMax.ico           # 程序图标
└── Newtonsoft.Json.dll    # 第三方库
```

**快捷方式**:
- 开始菜单: `%ProgramData%\Microsoft\Windows\Start Menu\Programs\CacheMax.lnk`
- 桌面（可选）: `%USERPROFILE%\Desktop\CacheMax.lnk`

### 4. 卸载CacheMax.bat ⚠️
```
用途: 完全卸载
权限: 需要管理员权限
操作:
- 🛑 停止所有CacheMax进程
- 🗑️ 删除程序文件目录
- 🔗 删除所有快捷方式
- 🌐 从系统PATH中移除
- 💾 保留用户数据和配置
```

## 🚀 使用流程

### 开发流程
```
1. 编译Debug版本: dotnet build --configuration Debug
2. 运行: 双击 调试CacheMax.bat
3. 测试功能（可启动多个实例）
```

### 发布流程
```
1. 编译Release版本: dotnet build --configuration Release
2. 测试: 双击 正式CacheMax.bat
3. 安装: 右键 安装CacheMax.bat -> 以管理员身份运行
4. 验证: 开始菜单启动CacheMax
```

### 系统安装流程
```
1. 【管理员】运行 安装CacheMax.bat
2. 选择是否创建桌面快捷方式 (Y/N)
3. 选择是否添加到系统PATH (Y/N)
4. 选择是否立即启动 (Y/N)
5. 完成安装
```

### 系统卸载流程
```
1. 【管理员】运行 卸载CacheMax.bat
2. 输入 YES 确认卸载
3. 自动清理所有程序文件和快捷方式
4. 手动清理用户数据（如需要）
```

## ⚠️ 注意事项

### 权限要求
- **调试/正式脚本**: 普通用户权限即可
- **安装/卸载脚本**: 必须以管理员身份运行

### 路径依赖
- 所有脚本必须在项目根目录 `C:\Code\CacheMax\` 运行
- 依赖编译输出目录结构保持不变

### 版本差异
```
Debug版本:
- 文件大小更大（包含调试信息）
- 允许多实例运行
- 性能略低但调试友好

Release版本:
- 文件大小更小（优化编译）
- 强制单实例运行
- 性能最优，适合生产使用
```

### 安装注意
- 安装前会自动停止运行中的CacheMax进程
- 重复安装会覆盖现有文件
- 卸载不会删除用户配置和缓存数据

## 🐛 故障排除

### 问题1: "需要管理员权限"
**解决**: 右键脚本 -> "以管理员身份运行"

### 问题2: "找不到Release版本的可执行文件"
**解决**: 先运行 `dotnet build --configuration Release`

### 问题3: 安装后程序无法启动
**检查**:
1. .NET 8.0 运行时是否已安装
2. 文件是否被杀毒软件拦截
3. 目标目录权限是否正确

### 问题4: 卸载不完全
**解决**: 重启后手动删除 `C:\Program Files\CacheMax`

## 📁 用户数据位置

程序运行时可能创建的用户数据：
```
%APPDATA%\CacheMax\          # 用户配置（如果存在）
%LOCALAPPDATA%\CacheMax\     # 本地数据（如果存在）
用户设置的缓存目录            # 缓存文件数据
```

这些数据在卸载时会保留，需要手动清理。

---

**建议**: 在生产部署前，先使用 `正式CacheMax.bat` 验证Release版本功能正常，再进行系统安装。