## ğŸ”´ ä¸¥é‡ - å¿…é¡»ä¿®å¤ï¼ˆå½±å“æ•°æ®å®‰å…¨ï¼‰

### 1.Â **åœæ­¢åŠ é€Ÿæ—¶æœ€åä¸€æ¬¡åŒæ­¥é¡ºåºé”™è¯¯**Â - æ•°æ®ä¸¢å¤±é£é™©

**ä½ç½®**:Â [CacheManagerService.cs:387-405](vscode-webview://1obv6044kv2g89pb9723emt4edo4qv0jnprcbmj6dt4h2ls8a4sf/CacheMax.GUI/Services/CacheManagerService.cs#L387-L405)

```csharp
// å½“å‰é”™è¯¯é¡ºåºï¼š
_fileSyncService.StopMonitoring(cachePath, progress);  // âŒ å…ˆåœæ­¢ç›‘æ§
await _fileSyncService.ForceSync(cachePath, progress); // ç„¶ååŒæ­¥
```

**é£é™©**: åœæ­¢ç›‘æ§ååˆ°æœ€ååŒæ­¥å‰è¿™æ®µæ—¶é—´çª—å£å†…ï¼Œç”¨æˆ·ä¿®æ”¹çš„æ–‡ä»¶ä¼šä¸¢å¤±

Â 

**ä¿®å¤**: äº¤æ¢ä¸¤è¡Œä»£ç é¡ºåºå³å¯

---

### 2.Â **Robocopyå¤åˆ¶å¤±è´¥ä¸æ¸…ç†éƒ¨åˆ†æ–‡ä»¶**Â - æ•°æ®æ®‹ç•™

**ä½ç½®**:Â [CacheManagerService.cs:253-267](vscode-webview://1obv6044kv2g89pb9723emt4edo4qv0jnprcbmj6dt4h2ls8a4sf/CacheMax.GUI/Services/CacheManagerService.cs#L253-L267)

Â 

**åœºæ™¯**: å¤åˆ¶100GBæ–‡ä»¶å¤¹ï¼Œå¤åˆ¶åˆ°50GBæ—¶ç£ç›˜ç©ºé—´ä¸è¶³å¤±è´¥ï¼Œä½†å·²å¤åˆ¶çš„50GBç•™åœ¨ç¼“å­˜ç›˜

Â 

**é£é™©**:

- æµªè´¹ç£ç›˜ç©ºé—´
- ä¸‹æ¬¡åˆå§‹åŒ–æ—¶æç¤º"ç¼“å­˜å·²å­˜åœ¨"ä½†æ•°æ®ä¸å®Œæ•´

**ä¿®å¤**: å¤±è´¥æ—¶æ¸…ç†cachePath

---

### 3.Â **Junctionåˆ›å»ºå¤±è´¥åçš„å›æ»šä¸å¯é **Â - æœ€å±é™©

**ä½ç½®**:Â [CacheManagerService.cs:276-290](vscode-webview://1obv6044kv2g89pb9723emt4edo4qv0jnprcbmj6dt4h2ls8a4sf/CacheMax.GUI/Services/CacheManagerService.cs#L276-L290)

Â 

**åœºæ™¯**:

1. RobocopyæˆåŠŸ â†’ ç¼“å­˜ç›˜æœ‰å®Œæ•´æ•°æ®
2. åŸå§‹ç›®å½•é‡å‘½åæˆåŠŸ â†’Â `D:\MyProject`Â â†’Â `D:\MyProject.original`
3. Junctionåˆ›å»ºå¤±è´¥ â†’ åº”ç”¨æ‰¾ä¸åˆ°Â `D:\MyProject`

**é£é™©**: å¦‚æœå›æ»šå¤±è´¥ï¼Œç³»ç»Ÿå¤„äºç ´åçŠ¶æ€ - åŸå§‹ç›®å½•ä¸è§äº†ï¼ŒJunctionä¹Ÿæ²¡åˆ›å»º

Â 

**ä¿®å¤**: å¢å¼ºå›æ»šå¯é æ€§æˆ–æä¾›æ˜ç¡®çš„æ‰‹åŠ¨æ¢å¤æŒ‡å¼•

---

### 4.Â **é‡å‘½ååŸå§‹ç›®å½•å¤±è´¥åæ¸…ç†å¼‚å¸¸è¢«åæ‰**

**ä½ç½®**:Â [CacheManagerService.cs:262-268](vscode-webview://1obv6044kv2g89pb9723emt4edo4qv0jnprcbmj6dt4h2ls8a4sf/CacheMax.GUI/Services/CacheManagerService.cs#L262-L268)

```csharp
try { Directory.Delete(cachePath, true); } catch { } // âŒ ç©ºcatchå—
```

**é£é™©**: æ¸…ç†å¤±è´¥æ—¶æ— æ—¥å¿—ï¼Œç”¨æˆ·æ— ä»æ’æŸ¥

---

## ğŸŸ  é«˜ - å¼ºçƒˆå»ºè®®ä¿®å¤ï¼ˆå¸¸è§ä½¿ç”¨åœºæ™¯ï¼‰

### 5.Â **ç£ç›˜ç©ºé—´ä¸è¶³æœªé¢„æ£€æŸ¥**

**åœºæ™¯**: åŠ é€Ÿ100GBæ–‡ä»¶å¤¹åˆ°åªæœ‰50GBç©ºé—´çš„ç¼“å­˜ç›˜

Â 

**å½±å“**: Robocopyå¤åˆ¶åŠå°æ—¶åæ‰å¤±è´¥ï¼Œæµªè´¹æ—¶é—´

Â 

**ä¿®å¤å»ºè®®**:

```csharp
var sourceSize = GetDirectorySize(sourcePath);
var availableSpace = new DriveInfo(Path.GetPathRoot(cachePath)).AvailableFreeSpace;
if (availableSpace < sourceSize * 1.1) 
{
    progress?.Report($"ç£ç›˜ç©ºé—´ä¸è¶³ï¼šéœ€è¦{sourceSize / 1024 / 1024 / 1024}GBï¼Œå¯ç”¨{availableSpace / 1024 / 1024 / 1024}GB");
    return false;
}
```

---

### 6.Â **ç¼“å­˜ç›˜å’ŒåŸå§‹ç›˜å¾ªç¯å¼•ç”¨é£é™©**

**åœºæ™¯**:

```
åŸå§‹ç›®å½•: D:\MyProject
ç¼“å­˜æ ¹ç›®å½•: D:\MyProject\Cache  â† åœ¨å†…éƒ¨ï¼
```

**é£é™©**: Robocopyæ­»å¾ªç¯ã€Junctionå¾ªç¯å¼•ç”¨

Â 

**ä¿®å¤**: æ£€æŸ¥è·¯å¾„åŒ…å«å…³ç³»

---

### 7.Â **FileSystemWatcherå¤§é‡æ–‡ä»¶æ—¶é˜Ÿåˆ—æ— ä¸Šé™**

**åœºæ™¯**:

- è§£å‹1ä¸‡ä¸ªæ–‡ä»¶çš„å‹ç¼©åŒ…
- Gitåˆ‡æ¢åˆ†æ”¯ï¼ˆæ•°åƒæ–‡ä»¶å˜æ›´ï¼‰
- ç¼–è¯‘å¤§å‹é¡¹ç›®

**å½“å‰ç¼“è§£**: æœ‰å»æŠ–åŠ¨(500ms)å’Œå»é‡æœºåˆ¶

Â 

**é—®é¢˜**: åˆå§‹å †ç§¯ä»ä¼šå¯¼è‡´å†…å­˜é£™å‡

Â 

**ä¿®å¤**: æ·»åŠ é˜Ÿåˆ—ä¸Šé™ä¿æŠ¤ï¼ˆå¦‚1000ä¸ªï¼‰

---

### 8.Â **ç¼“å­˜å†²çªå¯¹è¯æ¡†æœªå®ç°**

**ä½ç½®**:Â [CacheManagerService.cs:884-893](vscode-webview://1obv6044kv2g89pb9723emt4edo4qv0jnprcbmj6dt4h2ls8a4sf/CacheMax.GUI/Services/CacheManagerService.cs#L884-L893)

```csharp
// TODO: å®ç°çœŸæ­£çš„WPFå¯¹è¯æ¡†ä¾›ç”¨æˆ·é€‰æ‹©
return await Task.FromResult(CacheConflictChoice.SyncMode);
```

**å½±å“**: ç”¨æˆ·æ— æ³•é€‰æ‹©"æ¸…é™¤é‡å»º"æˆ–"å–æ¶ˆ"

---

## ğŸŸ¡ ä¸­ - å»ºè®®ä¼˜åŒ–ï¼ˆæå‡ç”¨æˆ·ä½“éªŒï¼‰

### 9.Â **FastCopyå¹¶å‘æ•°ç¡¬ç¼–ç ä¸º3**

**ä½ç½®**:Â [FileSyncService.cs:60-62](vscode-webview://1obv6044kv2g89pb9723emt4edo4qv0jnprcbmj6dt4h2ls8a4sf/CacheMax.GUI/Services/FileSyncService.cs#L60-L62)

Â 

**é—®é¢˜**:

- SSDå¯ä»¥æ”¯æŒ10+å¹¶å‘ï¼Œé»˜è®¤3æµªè´¹æ€§èƒ½
- HDDåªèƒ½æ”¯æŒ1-2å¹¶å‘ï¼Œé»˜è®¤3å¯¼è‡´ç£ç›˜æŠ–åŠ¨

**å»ºè®®**: æ ¹æ®ç£ç›˜ç±»å‹è‡ªé€‚åº”

---

### 10.Â **æ–‡ä»¶è¢«å ç”¨æ—¶é‡è¯•æ—¶é—´è¿‡é•¿ï¼ˆæœ€é•¿3åˆ†é’Ÿï¼‰**

**ä½ç½®**:Â [FileSyncService.cs:1612-1689](vscode-webview://1obv6044kv2g89pb9723emt4edo4qv0jnprcbmj6dt4h2ls8a4sf/CacheMax.GUI/Services/FileSyncService.cs#L1612-L1689)

Â 

**å½“å‰**: 8æ¬¡é‡è¯• + æŒ‡æ•°é€€é¿ï¼Œæœ€é•¿ç­‰120ç§’

Â 

**å½±å“**: å•ä¸ªæ–‡ä»¶é”å®šä¼šé˜»å¡æ•´ä¸ªåŒæ­¥é˜Ÿåˆ—

Â 

**å»ºè®®**: ç¼©çŸ­ä¸º5æ¬¡é‡è¯•ï¼Œæœ€é•¿30ç§’

---

### 11.Â **é”™è¯¯æç¤ºä¸å¤Ÿè¯¦ç»†**

**é—®é¢˜**: å¾ˆå¤šåœ°æ–¹åªæœ‰ç®€å•çš„"æ“ä½œå¤±è´¥"

Â 

**å»ºè®®**: æä¾›å…·ä½“åŸå› å’Œè§£å†³å»ºè®®ï¼ˆå¦‚"ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œè¯·æ¸…ç†è‡³å°‘XXGç©ºé—´"ï¼‰

---

## âšª ä½ - å¯é€‰ï¼ˆè¾¹ç•Œæ¡ä»¶/ç†è®ºé£é™©ï¼‰

### 12.Â **éNTFSæ–‡ä»¶ç³»ç»Ÿæœªæ£€æŸ¥**

**åœºæ™¯**: ç”¨æˆ·é€‰æ‹©FAT32/exFATç¼“å­˜ç›˜

Â 

**é£é™©**: Junctionåªæ”¯æŒNTFSï¼Œä¼šå¤±è´¥

Â 

**å»ºè®®**: é¢„æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿç±»å‹

---

### 13.Â **Robocopyé€€å‡ºç åˆ¤æ–­ä¾èµ–è¾“å‡ºè§£æ**

**ä½ç½®**:Â [CacheManagerService.cs:1069-1120](vscode-webview://1obv6044kv2g89pb9723emt4edo4qv0jnprcbmj6dt4h2ls8a4sf/CacheMax.GUI/Services/CacheManagerService.cs#L1069-L1120)

Â 

**é—®é¢˜**: ä¾èµ–è§£æä¸­æ–‡è¾“å‡ºï¼Œå¯èƒ½å› ç³»ç»Ÿè¯­è¨€å¤±è´¥

Â 

**å½±å“**: å¯èƒ½è¯¯åˆ¤æˆåŠŸ/å¤±è´¥

---

### 14.Â **FastCopyè¿›ç¨‹30åˆ†é’Ÿè¶…æ—¶å¼ºåˆ¶ç»ˆæ­¢**

**åœºæ™¯**: å¤åˆ¶100GBè¶…å¤§æ–‡ä»¶

Â 

**é£é™©**: Killè¿›ç¨‹å¯èƒ½å¯¼è‡´æ–‡ä»¶ä¸å®Œæ•´

Â 

**è¯„ä¼°**: 30åˆ†é’Ÿå·²ç»å¾ˆé•¿ï¼Œæå°‘é‡åˆ°

---

## æˆ‘çš„å»ºè®®ä¼˜å…ˆçº§

**ç«‹å³ä¿®å¤ï¼ˆ1-2å°æ—¶å·¥ä½œé‡ï¼‰**:

1. âœ… åœæ­¢åŠ é€ŸåŒæ­¥é¡ºåºï¼ˆäº¤æ¢2è¡Œä»£ç ï¼‰
2. âœ… Robocopyå¤±è´¥æ¸…ç†ï¼ˆæ·»åŠ Directory.Deleteï¼‰
3. âœ… ç©ºcatchå—æ”¹ä¸ºè®°å½•æ—¥å¿—

**æœ¬å‘¨ä¿®å¤ï¼ˆåŠå¤©å·¥ä½œé‡ï¼‰**: 4. âœ… ç£ç›˜ç©ºé—´é¢„æ£€æŸ¥ 5. âœ… è·¯å¾„å¾ªç¯å¼•ç”¨æ£€æŸ¥ 6. âœ… ç¼“å­˜å†²çªå¯¹è¯æ¡†å®ç°

Â 

**è€ƒè™‘ä¼˜åŒ–ï¼ˆä¸å½±å“æ ¸å¿ƒåŠŸèƒ½ï¼‰**: 7. FileSystemWatcheré˜Ÿåˆ—ä¸Šé™ 8. FastCopyå¹¶å‘æ•°è‡ªé€‚åº” 9. æ–‡ä»¶ç³»ç»Ÿç±»å‹æ£€æŸ¥

Â 

**è¿‡åº¦å·¥ç¨‹åŒ–ï¼ˆæš‚ä¸å¤„ç†ï¼‰**:

- FastCopyè¶…æ—¶æœºåˆ¶è°ƒæ•´ï¼ˆå½“å‰å·²å¤Ÿç”¨ï¼‰
- Robocopyè¾“å‡ºè§£æå›½é™…åŒ–ï¼ˆç”¨æˆ·éƒ½æ˜¯ä¸­æ–‡ç¯å¢ƒï¼‰
- ErrorRecoveryServiceæ™ºèƒ½è¯†åˆ«ï¼ˆç°æœ‰æœºåˆ¶å·²è¶³å¤Ÿï¼‰

ä½ è§‰å¾—å“ªäº›æ˜¯å¿…é¡»å¤„ç†çš„ï¼Ÿå“ªäº›æˆ‘è€ƒè™‘è¿‡åº¦äº†ï¼Ÿ